name: Release

on:
  push:
    tags:
      - 'v*'  # åªåœ¨æ‰“ tag æ—¶è§¦å‘ï¼Œå¦‚ v20211203-zh-v1.0

jobs:
  release:
    name: Build & Release
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Pull build container
        run: docker pull ghcr.io/ysyx-opendoc/asciidoctor:latest

      - name: Build PDF
        run: |
          docker run --rm -v ${{ github.workspace }}:/build ghcr.io/ysyx-opendoc/asciidoctor:latest \
          /bin/sh -c 'cd ./build/build && make'

      - name: Upload release asset
        uses: softprops/action-gh-release@v2
        with:
          files: build/unpriv-isa-asciidoc.pdf
          name: "RISC-V éç‰¹æƒçº§æ‰‹å†Œä¸­æ–‡ç¿»è¯‘"
          tag_name: ${{ github.ref_name }}
          body: |
            ğŸ“˜ æœ¬ç‰ˆæœ¬ä¸º RISC-V éç‰¹æƒçº§ ISA æ‰‹å†Œï¼ˆv20240411ï¼‰çš„ä¸­æ–‡ç¿»è¯‘ã€‚
            ğŸ‘‰ å¦‚æœ‰é—®é¢˜æ¬¢è¿æäº¤ issueã€‚
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

